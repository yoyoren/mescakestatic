(function(){var b=0;var a=function(q){b++;var D=this;var x=12;var q=q||{};D.el=$(q.el);D.onclick=q.onclick||function(){};var l=D.el.next().val();var g=D.type=q.type;var k='<div class="area-list date-list" id="picker_'+b+'">					   <p class="first"><em class="data-corner-left left_arrow" style="display:none"></em><span class="picker_title">选择日期</span><em class="data-corner-right right_arrow" style="display:none"></em></p>					  <ul>						<%=container%>					  </ul>					  <%=pageHTML%>					</div>';var p=$("body");this.currentPage=0;this.totalPage=0;if(g=="zone"){M.get("route.php?mod=order&action=get_region",{},function(H){var F="";for(var E=0;E<H.length;E++){var G="";if(H[E].region_id==571||H[E].region_id==572){H[E].region_name+="*"}if(H[E].region_id==l){G="current"}F+='<li class="pos-r '+G+'" data-id="'+H[E].region_id+'"  style="position:relative">'+H[E].region_name+"</li>"}k=k.replace("<%=container%>",F);k=k.replace("<%=pageHTML%>","");p.append(k);D.defaultEvent();D.setTitle("选择区")})}else{if(g=="street"){var A=q.data;var m="";for(var y in A){var j="";if(y==l){j="current"}m+='<li class="pos-r '+j+'" data-id="'+y+'"  style="position:relative">'+A[y].name+'<em class="wap-radio wap-radio-item current '+j+'"></em></li>'}k=k.replace("<%=container%>",m);k=k.replace("<%=pageHTML%>","");p.append(k);D.defaultEvent();D.setTitle("选择街道")}else{if(g=="date"){var m="";var z=[];var c=0;var r=parseInt(window.server_date);l=$("#month_sel").val()+$("#day_sel").val();for(var y=0;y<30;y++){c++;var o=new Date(r);var n=o.getFullYear();var C=o.getMonth()+1;var w=o.getDate();r=r+(3600*24*1000);var v=C+"月"+w+"日";var j="";var u='<li class="pos-r '+j+'" data-day="'+w+'" data-month="'+C+'" data-year="'+n+'"  style="position:relative">'+v+"</li>";if(C+""+w==l){j="current"}if(c>12){z.push(u)}else{m+=u}}var e=[];while(z.length){var t=z.splice(0,12);e.push('<ul style="display:none">');e.push(t.join(""));e.push("</ul>");this.totalPage++}k=k.replace("<%=container%>",m);k=k.replace("<%=pageHTML%>",e.join(""));p.append(k);D.defaultEvent();D.setTitle("选择送货日期")}else{if(g=="time"){var m="";var c=0;l=$("#hour_sel").val()+$("#minute_sel").val();var B=q.beginHour;var f=q.endHour;for(var y=B;y<=f;y++){var h=y;var s=0;var v=y+":00";var j="";if(h+"0"==l){j="current"}m+='<li class="pos-r '+j+'" data-hour="'+h+'" data-minute="'+s+'"  style="position:relative">'+v+"</li>";if(y<22){var v=y+":30";s=30;j="";if(h+""+s==l){j="current"}m+='<li class="pos-r '+j+'" data-hour="'+h+'" data-minute="'+s+'" style="position:relative">'+v+"</li>"}}k=k.replace("<%=container%>",m);k=k.replace("<%=pageHTML%>","");p.append(k);D.defaultEvent();D.setTitle("选择送货时间")}}}}p.append('<div class="gray-bg pick_bg" style="z-index:10;"></div>');$("#scroll_container").css("overflow","hidden");$(".pick_bg")[CLICK](function(){D.destory()})};a.prototype.defaultEvent=function(){var c=this;c.listContainer=$("#picker_"+b);if(this.totalPage>0){c.listContainer.find(".right_arrow").show()}c.listContainer.delegate("li",CLICK,function(){var d=$(this);c.el.next().val(d.data("id"));c.el.val(d.text());c.destory();if(c.type=="date"){c.onclick(d.data("year"),d.data("month"),d.data("day"))}else{if(c.type=="time"){c.onclick(d.data("hour"),d.data("minute"),d.data("day"))}else{c.onclick(d.data("id"))}}});c.listContainer.delegate(".left_arrow",CLICK,function(){c.currentPage--;if(c.currentPage<0){c.currentPage=0}else{c.listContainer.find(".left_arrow").show()}if(c.currentPage==0){c.listContainer.find(".left_arrow").hide()}c.listContainer.find(".right_arrow").show();var d=c.listContainer.find("ul");d.hide();d.eq(c.currentPage).show()}).delegate(".right_arrow",CLICK,function(){c.currentPage++;if(c.currentPage>c.totalPage){c.currentPage=c.totalPage}else{c.listContainer.find(".right_arrow").show()}if(c.currentPage==c.totalPage){c.listContainer.find(".right_arrow").hide()}c.listContainer.find(".left_arrow").show();var d=c.listContainer.find("ul");d.hide();d.eq(c.currentPage).show()})};a.prototype.close=function(){$("#scroll_container").css("overflow","auto");this.listContainer.hide();$(".pick_bg").remove()};a.prototype.destory=function(){$("#scroll_container").css("overflow","auto");this.listContainer.remove();$(".pick_bg").remove()};a.prototype.setTitle=function(c){this.listContainer.find(".picker_title").html(c)};window.Picker=a})();(function(){var c={region_sel:$("#region_sel"),dis_district:$("#district_sel")};var f;var e=$("#street_container");var d=$("#zone_container");$("#zone_picker")[CLICK](function(){new Picker({type:"zone",el:this,onclick:function(k){M.get("route.php?mod=order&action=get_district",{city:k},function(n){if(n.code==0){if(n.data){for(var m in n.data){var l=n.data[m].name;if(!n.data[m].free){if(l.indexOf("*")<0){n.data[m].name="*"+l}}}f=n.data;e.show();d.css({width:"30%"})}else{e.hide();d.css({width:"75%"})}}})}})});$("#street_picker")[CLICK](function(){new Picker({type:"street",el:this,data:f,onclick:function(k){}})});var j=$("#region_sel");var h=$("#district_sel");var i=$("#new_address_popup");var b=$("#new_contact_popup");var a=$("#new_tel_popup");var g=function(){if($.trim(b.val())==""){M.confirm("请填写一个收货人姓名");return false}var k=$.trim(a.val());if(!/\d{5,}/.test(k)){M.confirm("请填写一个合法的联系方式");return false}if($.trim($("#region_sel").val())==0){M.confirm("送货地区选择错误");return false}if($.trim(h.val())==0&&h.parent().css("display")!="none"){M.confirm("送货地区选择错误");return false}if($.trim(i.val())==""){M.confirm("请填写收货地址");return false}return true};$("#save_address")[CLICK](function(){var o=j.val();var n=h.val();var l=i.val();var m=a.val();var k=b.val();if(!g()){return}M.loading();M.post("route.php?mod=order&action=add_order_address",{country:441,city:o.split("_")[0],address:l,district:n.split("_")[0],tel:m,contact:k},function(p){if(p.code==0){location.href=M.touchDomain+"checkout"}})})})();